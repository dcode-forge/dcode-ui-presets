<template>
    <article class="code-block" v-if="code">
        <header>
            <span v-if="copyStatus">{{ copyStatus }}</span>
            <button @click="handleCopy">
                <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.01582 9.50588C6.10596 9.41597 6.22812 9.36555 6.35543 9.36572C6.48274 9.36588 6.60477 9.41661 6.69468 9.50674C6.78459 9.59688 6.83501 9.71904 6.83485 9.84635C6.83469 9.97366 6.78396 10.0957 6.69382 10.1856L5.54653 11.3303L4.85867 12.0182C4.34055 12.5334 3.63927 12.8221 2.9086 12.821C2.17794 12.82 1.4775 12.5292 0.96087 12.0125C0.444237 11.4958 0.153568 10.7954 0.15259 10.0647C0.151613 9.33405 0.440407 8.6328 0.955655 8.11474L3.6711 5.40015C4.18875 4.88273 4.89069 4.59206 5.6226 4.59206C6.35451 4.59206 7.05646 4.88273 7.57411 5.40015C7.66413 5.49017 7.71471 5.61227 7.71471 5.73958C7.71471 5.86689 7.66413 5.98899 7.57411 6.07901C7.48409 6.16903 7.36199 6.21961 7.23468 6.21961C7.10737 6.21961 6.98527 6.16903 6.89525 6.07901C6.5577 5.74154 6.09992 5.55195 5.6226 5.55195C5.14529 5.55195 4.68751 5.74154 4.34996 6.07901L1.63366 8.79359C1.29607 9.13118 1.10642 9.58904 1.10642 10.0665C1.10642 10.5439 1.29607 11.0017 1.63366 11.3393C1.97124 11.6769 2.42911 11.8666 2.90652 11.8666C3.38394 11.8666 3.8418 11.6769 4.17938 11.3393L4.8651 10.6515L6.01325 9.50588H6.01582Z" fill="white"/>
                    <path d="M6.83396 3.59158C6.74383 3.68149 6.62167 3.73191 6.49436 3.73175C6.36705 3.73159 6.24501 3.68086 6.15511 3.59072C6.0652 3.50059 6.01478 3.37843 6.01494 3.25111C6.0151 3.1238 6.06583 3.00177 6.15596 2.91186C6.84825 2.22157 7.23082 1.83986 7.30368 1.76671L7.9894 1.081C8.24544 0.823549 8.54977 0.619153 8.88495 0.47952C9.22012 0.339887 9.57955 0.267761 9.94265 0.267275C10.3057 0.26679 10.6654 0.337954 11.0009 0.476689C11.3365 0.615425 11.6413 0.819006 11.8981 1.07577C12.1548 1.33253 12.3584 1.63743 12.4971 1.97299C12.6358 2.30855 12.7069 2.66818 12.7064 3.03128C12.7058 3.39438 12.6337 3.7538 12.494 4.08896C12.3543 4.42412 12.1499 4.72842 11.8924 4.98444L9.17698 7.69988C8.65933 8.21731 7.95738 8.50798 7.22547 8.50798C6.49356 8.50798 5.79161 8.21731 5.27396 7.69988C5.18394 7.60986 5.13336 7.48776 5.13336 7.36045C5.13336 7.23314 5.18394 7.11104 5.27396 7.02102C5.36398 6.931 5.48608 6.88043 5.61339 6.88043C5.7407 6.88043 5.8628 6.931 5.95282 7.02102C6.11997 7.18819 6.31841 7.32079 6.53681 7.41126C6.7552 7.50173 6.98929 7.5483 7.22568 7.5483C7.46208 7.5483 7.69616 7.50173 7.91456 7.41126C8.13295 7.32079 8.33139 7.18819 8.49854 7.02102L11.2136 4.30558C11.3809 4.13857 11.5137 3.94023 11.6043 3.7219C11.695 3.50357 11.7418 3.26951 11.742 3.0331C11.7422 2.79669 11.6959 2.56255 11.6056 2.34405C11.5153 2.12555 11.3829 1.92697 11.2159 1.75964C11.0489 1.59232 10.8506 1.45953 10.6322 1.36886C10.4139 1.27818 10.1798 1.2314 9.94343 1.23118C9.70702 1.23096 9.47288 1.27731 9.25438 1.36758C9.03588 1.45785 8.8373 1.59027 8.66997 1.75729L7.98426 2.443L6.83568 3.58901L6.83396 3.59158Z" fill="white"/>
                </svg>
            </button>
        </header>
        <prism-editor ref="editor" class="code-editor" v-model="code" :highlight="highlighter" line-numbers />
    </article>
</template>

<script>
  import { PrismEditor } from 'vue-prism-editor';
  import 'vue-prism-editor/dist/prismeditor.min.css';
  import { highlight, languages } from 'prismjs/components/prism-core';
  import 'prismjs/components/prism-clike';
  import 'prismjs/components/prism-javascript';
  import 'prismjs/themes/prism-tomorrow.css'; // import syntax highlighting styles

  export default {
    components: {
      PrismEditor,
    },
    props: {
        codeContent: {
            type: String,
        }
    },
    data() {
      return {
            copyStatus : null,
            code: null,
      }  
    },
    created() {
      this.code = this.codeContent.replace(/\\/g, '')
    },
    methods: {
      highlighter(code) {
        return highlight(code, languages.js); // languages.<insert language> to return html with markup
      },
      handleCopy() {
        const codeContent = this.$refs.editor.$refs.textarea
        codeContent.select()
        let copied = document.execCommand('copy')
        copied ? this.copyStatus = 'Copied' : this.copyStatus = 'Cant copy content'
        window.getSelection().removeAllRanges()
        setTimeout(()=>{
            this.copyStatus = null
        }, 1500)
      },
    },
  };
</script>
 
